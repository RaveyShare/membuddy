# 微信小程序域名配置指南

## 问题描述
当微信小程序尝试访问 `http://localhost:8000` 时，会出现以下错误：
```
http://localhost:8000 不在以下 request 合法域名列表中
request:fail url not in domain list
```

## 解决方案

### 1. 代码修改（已完成）
- ✅ 将 `mina/utils/api.js` 中的 `baseURL` 从 `http://localhost:8000` 改为 `https://api.membuddy.ravey.site`
- ✅ 将 `mina/app.js` 中的 `baseURL` 从 `http://localhost:8000` 改为 `https://api.membuddy.ravey.site`
- ✅ 确保所有API请求使用HTTPS协议

### 2. 微信公众平台配置

#### 步骤1：登录微信公众平台
1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 使用小程序管理员账号登录

#### 步骤2：进入开发管理
1. 在左侧菜单中点击「开发」→「开发管理」
2. 点击「开发设置」选项卡

#### 步骤3：配置服务器域名
1. 找到「服务器域名」部分
2. 点击「修改」按钮
3. 在「request合法域名」中添加：`https://api.membuddy.ravey.site`

#### 步骤4：保存配置
1. 点击「保存并提交」
2. 等待审核通过（通常几分钟内完成）

### 3. 开发工具配置

#### 方法1：刷新项目配置（推荐）
1. 在微信开发者工具中，点击右上角「详情」
2. 点击「域名信息」
3. 点击「刷新」按钮，同步最新的域名配置
4. 重新编译项目

#### 方法2：临时开发配置（仅开发环境）
如果需要在开发环境中临时跳过域名校验：
1. 在微信开发者工具中，点击右上角「详情」
2. 在「本地设置」中勾选「不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书」
3. 重新编译项目

**注意：此选项仅在开发环境有效，正式发布时必须配置合法域名**

### 4. 验证配置

#### 检查域名配置是否生效
1. 重新编译小程序项目
2. 测试登录功能
3. 查看控制台是否还有域名校验错误

#### 常见问题排查
- **域名未生效**：等待几分钟后重试，或重新刷新项目配置
- **HTTPS证书问题**：确保 `api.membuddy.ravey.site` 的SSL证书有效
- **端口问题**：确保域名配置中不包含端口号（HTTPS默认443端口）

### 5. 注意事项

1. **域名格式要求**：
   - 必须使用HTTPS协议
   - 不能包含端口号
   - 不能使用IP地址
   - 不能使用localhost或127.0.0.1

2. **配置限制**：
   - 每个小程序最多可配置20个request合法域名
   - 域名配置后需要重新发布小程序才能在正式环境生效

3. **开发建议**：
   - 开发环境可以使用「不校验合法域名」选项
   - 测试环境和生产环境必须配置合法域名
   - 建议使用统一的API域名管理

## 相关文档
- [微信小程序网络请求文档](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html)
- [微信公众平台开发设置](https://mp.weixin.qq.com/)