# ç”¨æˆ·ä¸­å¿ƒé›†æˆæµ‹è¯•æŒ‡å—

## æ¦‚è¿°
æœ¬æŒ‡å—å¸®åŠ©æ‚¨æµ‹è¯•å¾®ä¿¡å°ç¨‹åºä¸ç”¨æˆ·ä¸­å¿ƒçš„é›†æˆï¼Œç¡®ä¿ç™»å½•æµç¨‹æ­£å¸¸å·¥ä½œã€‚

## ç¯å¢ƒé…ç½®

### 1. å¼€å‘ç¯å¢ƒåˆ‡æ¢
åœ¨ `mina/utils/dev-config.js` ä¸­ä¿®æ”¹ç¯å¢ƒé…ç½®ï¼š

```javascript
// å½“å‰ç¯å¢ƒ - å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™ä¸ªå€¼æ¥åˆ‡æ¢ç¯å¢ƒ
const currentEnv = 'local'; // å¯é€‰å€¼ï¼šdevelopment, local, testing, production
```

### 2. ç¯å¢ƒé€‰é¡¹
- **development**: ä½¿ç”¨ Mock æ•°æ®
- **local**: ä½¿ç”¨æœ¬åœ°ç”¨æˆ·ä¸­å¿ƒï¼ˆhttp://localhost:8081ï¼‰
- **testing**: ä½¿ç”¨æµ‹è¯•ç¯å¢ƒ
- **production**: ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒ

## æµ‹è¯•æ­¥éª¤

### æ­¥éª¤1ï¼šMockæ¨¡å¼æµ‹è¯•ï¼ˆæ¨èå…ˆè¿›è¡Œï¼‰

1. è®¾ç½®ç¯å¢ƒä¸º `development`ï¼š
```javascript
const currentEnv = 'development';
```

2. åœ¨å°ç¨‹åºå¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€æ§åˆ¶å°

3. æ‰§è¡Œæµ‹è¯•å‘½ä»¤ï¼š
```javascript
// æµ‹è¯•é…ç½®
const config = require('./mina/utils/dev-config.js');
console.log('å½“å‰ç¯å¢ƒé…ç½®:', config.getCurrentEnvConfig());

// æµ‹è¯•ç”¨æˆ·ä¸­å¿ƒç™»å½•
const { userCenterLogin } = require('./mina/utils/auth.js');
const testLogin = async () => {
  try {
    const result = await userCenterLogin(
      'wxe6d828ae0245ab9c', // appId
      'test_code_123', // code
      { nickname: 'æµ‹è¯•ç”¨æˆ·', avatarUrl: '' } // userInfo
    );
    console.log('ç™»å½•æˆåŠŸ:', result);
  } catch (error) {
    console.error('ç™»å½•å¤±è´¥:', error);
  }
};
testLogin();
```

### æ­¥éª¤2ï¼šæœ¬åœ°ç”¨æˆ·ä¸­å¿ƒæµ‹è¯•

1. ç¡®ä¿ç”¨æˆ·ä¸­å¿ƒæœåŠ¡å·²å¯åŠ¨ï¼š
```bash
cd user-center
npm run dev
# æœåŠ¡åº”è¯¥åœ¨ http://localhost:8081 å¯åŠ¨
```

2. è®¾ç½®ç¯å¢ƒä¸º `local`ï¼š
```javascript
const currentEnv = 'local';
```

3. æµ‹è¯•çœŸå®æ¥å£ï¼š
```javascript
// æµ‹è¯•ç”¨æˆ·ä¸­å¿ƒæ¥å£
const { api } = require('./mina/utils/api.js');

const testUserCenter = async () => {
  try {
    const response = await api.userCenter.wxLogin(
      'wxe6d828ae0245ab9c',
      '0e3jPi1w37FxV53P351w3gHGEr3jPi1F',
      { nickname: 'rw', avatarUrl: '' }
    );
    console.log('ç”¨æˆ·ä¸­å¿ƒå“åº”:', response);
  } catch (error) {
    console.error('æ¥å£è°ƒç”¨å¤±è´¥:', error);
  }
};
testUserCenter();
```

### æ­¥éª¤3ï¼šå®Œæ•´ç™»å½•æµç¨‹æµ‹è¯•

1. åœ¨å°ç¨‹åºä¸­ç‚¹å‡»"å¾®ä¿¡ç™»å½•"æŒ‰é’®

2. è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼š
```
è·å–å¾®ä¿¡ç™»å½•codeæˆåŠŸ: xxxxxxx
ç”¨æˆ·ä¸­å¿ƒç™»å½•æˆåŠŸ: { token: "...", expiresIn: 86400, userInfo: {...} }
```

3. æ£€æŸ¥æœ¬åœ°å­˜å‚¨ï¼š
```javascript
// æ£€æŸ¥å­˜å‚¨çš„æ•°æ®
console.log('Token:', wx.getStorageSync('access_token'));
console.log('User Info:', wx.getStorageSync('user_data'));
```

## æ¥å£éªŒè¯

### ç”¨æˆ·ä¸­å¿ƒç™»å½•æ¥å£
**è¯·æ±‚åœ°å€**: `POST http://localhost:8081/front/auth/wxMiniAppLogin`

**è¯·æ±‚æ ¼å¼**: 
```json
{
  "appId": "wxe6d828ae0245ab9c",
  "code": "å¾®ä¿¡ç™»å½•code",
  "userInfo": {
    "nickname": "ç”¨æˆ·æ˜µç§°",
    "avatarUrl": "å¤´åƒURL"
  }
}
```

**å“åº”æ ¼å¼**:
```json
{
  "code": 0,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9...",
    "expiresIn": 86400,
    "userInfo": {
      "id": 5,
      "nickname": "rw",
      "avatarUrl": ""
    }
  },
  "message": null
}
```

## å¸¸è§é—®é¢˜æ’æŸ¥

### 1. ç½‘ç»œè¯·æ±‚å¤±è´¥
- æ£€æŸ¥ç”¨æˆ·ä¸­å¿ƒæœåŠ¡æ˜¯å¦å¯åŠ¨
- ç¡®è®¤ç«¯å£å·æ­£ç¡®ï¼ˆ8081ï¼‰
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. ç™»å½•å¤±è´¥
- ç¡®è®¤ appId é…ç½®æ­£ç¡®
- æ£€æŸ¥å¾®ä¿¡ç™»å½• code æ˜¯å¦æœ‰æ•ˆ
- æŸ¥çœ‹ç”¨æˆ·ä¸­å¿ƒæ—¥å¿—

### 3. Token æœªæºå¸¦
- ç¡®è®¤ç™»å½•æˆåŠŸåä¿å­˜äº† token
- æ£€æŸ¥ API è¯·æ±‚çš„ Authorization å¤´
- æŸ¥çœ‹ `getToken()` å‡½æ•°è¿”å›å€¼

### 4. Mock æ•°æ®ä¸ç”Ÿæ•ˆ
- ç¡®è®¤ç¯å¢ƒè®¾ç½®ä¸º `development`
- æ£€æŸ¥ `shouldUseMock()` è¿”å›å€¼ä¸º `true`
- æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰ "ğŸ”§ å¼€å‘æ¨¡å¼ï¼šä½¿ç”¨Mockæ•°æ®" æ—¥å¿—

## è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
// å¼€å¯è¯¦ç»†æ—¥å¿—
wx.setEnableDebug({ enableDebug: true });
```

### 2. æ£€æŸ¥è¯·æ±‚è¯¦æƒ…
```javascript
// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
const { apiClient } = require('./mina/utils/api.js');
apiClient.addRequestInterceptor((config) => {
  console.log('è¯·æ±‚é…ç½®:', config);
  return config;
});
```

### 3. éªŒè¯ Token æœ‰æ•ˆæ€§
```javascript
// æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ
const { authManager } = require('./mina/utils/auth.js');
console.log('Token è¿‡æœŸçŠ¶æ€:', authManager.isTokenExpired());
console.log('è®¤è¯çŠ¶æ€:', authManager.isAuthenticated());
```

## ä¸‹ä¸€æ­¥

1. Mock æ¨¡å¼æµ‹è¯•é€šè¿‡åï¼Œåˆ‡æ¢åˆ°æœ¬åœ°ç¯å¢ƒæµ‹è¯•
2. æœ¬åœ°ç¯å¢ƒæµ‹è¯•é€šè¿‡åï¼Œå¯ä»¥éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
3. æœ€ååœ¨ç”Ÿäº§ç¯å¢ƒè¿›è¡Œæœ€ç»ˆéªŒè¯

å¦‚éœ€å¸®åŠ©ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚