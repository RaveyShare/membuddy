# ç”¨æˆ·ä¸­å¿ƒå¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ å¿«é€Ÿé…ç½®

### 1. åŸºæœ¬é…ç½®ï¼ˆ5åˆ†é’Ÿï¼‰

#### æ­¥éª¤ 1: æ›´æ–°ç¯å¢ƒé…ç½®
ç¼–è¾‘ `mina/utils/dev-config.js`ï¼š

```javascript
// å¼€å‘ç¯å¢ƒ - ä½¿ç”¨ Mock æ•°æ®
const DEV_CONFIG = {
  useMock: true,              // ğŸ‘ˆ å¼€å‘æ—¶å»ºè®®å…ˆç”¨ Mock
  useUserCenter: true,        // ğŸ‘ˆ å¯ç”¨ç”¨æˆ·ä¸­å¿ƒ
  userCenterBaseUrl: 'https://your-user-center.com/api'
};

// ç”Ÿäº§ç¯å¢ƒ - ä½¿ç”¨çœŸå®æ¥å£
const PROD_CONFIG = {
  useMock: false,             // ğŸ‘ˆ ç”Ÿäº§ç¯å¢ƒå…³é—­ Mock
  useUserCenter: true,
  userCenterBaseUrl: 'https://prod-user-center.com/api'
};
```

#### æ­¥éª¤ 2: æµ‹è¯•é…ç½®
åœ¨å°ç¨‹åºå¼€å‘è€…å·¥å…·æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®
wx.testConfig.runAllTests();

// æµ‹è¯•ç™»å½•æµç¨‹
wx.testLogin.testCompleteLoginFlow();
```

### 2. æ¥å£å¯¹æ¥ï¼ˆ10åˆ†é’Ÿï¼‰

#### ä½ çš„ç”¨æˆ·ä¸­å¿ƒéœ€è¦æä¾›ä»¥ä¸‹æ¥å£ï¼š

```bash
# 1. å¾®ä¿¡ç™»å½•æ¥å£
POST /api/auth/wechat/mini
Content-Type: application/json

{
  "code": "å¾®ä¿¡ç™»å½•code",
  "userInfo": {
    "nickname": "ç”¨æˆ·æ˜µç§°",
    "avatarUrl": "å¤´åƒURL"
  }
}

# å“åº”æ ¼å¼ï¼š
{
  "success": true,
  "data": {
    "accessToken": "jwt_token",
    "tokenType": "Bearer",
    "expiresIn": 7200,
    "refreshToken": "refresh_token",
    "user": {
      "id": "user_id",
      "nickname": "æ˜µç§°",
      "avatarUrl": "å¤´åƒ"
    }
  }
}
```

```bash
# 2. åˆ·æ–°Tokenæ¥å£
POST /api/auth/refresh
Authorization: Bearer refresh_token

# å“åº”æ ¼å¼ï¼š
{
  "success": true,
  "data": {
    "accessToken": "new_jwt_token",
    "tokenType": "Bearer",
    "expiresIn": 7200
  }
}
```

```bash
# 3. è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£
GET /api/user/info
Authorization: Bearer access_token

# å“åº”æ ¼å¼ï¼š
{
  "success": true,
  "data": {
    "id": "user_id",
    "nickname": "æ˜µç§°",
    "avatarUrl": "å¤´åƒ",
    "openid": "wx_openid"
  }
}
```

```bash
# 4. ç™»å‡ºæ¥å£
POST /api/auth/logout
Authorization: Bearer access_token

# å“åº”æ ¼å¼ï¼š
{
  "success": true,
  "message": "ç™»å‡ºæˆåŠŸ"
}
```

## ğŸ”§ å¼€å‘æ¨¡å¼

### Mock æ¨¡å¼ï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰

```javascript
// 1. å¯ç”¨ Mock æ¨¡å¼
const config = {
  useMock: true,
  useUserCenter: true
};

// 2. æµ‹è¯• Mock ç™»å½•
wx.testLogin.testMockLogin();
```

**ä¼˜åŠ¿ï¼š**
- âœ… æ— éœ€çœŸå®åç«¯å³å¯å¼€å‘
- âœ… å¿«é€Ÿæµ‹è¯•å„ç§åœºæ™¯
- âœ… ç¨³å®šçš„æµ‹è¯•æ•°æ®

### çœŸå®æ¥å£æ¨¡å¼

```javascript
// 1. é…ç½®çœŸå®æ¥å£
const config = {
  useMock: false,
  useUserCenter: true,
  userCenterBaseUrl: 'https://your-api.com/api'
};

// 2. æµ‹è¯•çœŸå®æ¥å£
wx.testLogin.testCompleteLoginFlow();
```

## ğŸ“± å°ç¨‹åºä½¿ç”¨

### ç™»å½•é¡µé¢è°ƒç”¨

```javascript
// pages/auth/login/login.js
import { userCenterLogin } from '../../../utils/auth.js';

Page({
  async onWechatLogin() {
    try {
      // 1. è·å–å¾®ä¿¡ç™»å½• code
      const { code } = await wx.login();
      
      // 2. è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
      const userInfo = await this.getUserProfile();
      
      // 3. è°ƒç”¨ç”¨æˆ·ä¸­å¿ƒç™»å½•
      const result = await userCenterLogin(code, userInfo);
      
      if (result.success) {
        // 4. ç™»å½•æˆåŠŸï¼Œè·³è½¬é¦–é¡µ
        wx.switchTab({ url: '/pages/index/index' });
      }
    } catch (error) {
      wx.showToast({
        title: 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•',
        icon: 'none'
      });
    }
  }
});
```

### å…¶ä»–é¡µé¢ä½¿ç”¨è®¤è¯

```javascript
// ä»»æ„é¡µé¢
import { getAccessToken, isTokenExpired } from '../../utils/auth.js';

Page({
  onLoad() {
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    if (isTokenExpired()) {
      // è·³è½¬åˆ°ç™»å½•é¡µ
      wx.navigateTo({ url: '/pages/auth/login/login' });
      return;
    }
    
    // è·å–ç”¨æˆ·æ•°æ®
    this.loadUserData();
  },
  
  async loadUserData() {
    const token = getAccessToken();
    // ä½¿ç”¨ token è°ƒç”¨ API
  }
});
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

### 1. é…ç½®æµ‹è¯•

```javascript
// æµ‹è¯•ç¯å¢ƒé…ç½®
wx.testConfig.testEnvConfig();

// æµ‹è¯• Mock æ•°æ®
wx.testConfig.testMockData();

// æµ‹è¯• API å®¢æˆ·ç«¯
wx.testConfig.testApiClient();
```

### 2. ç™»å½•æµ‹è¯•

```javascript
// æµ‹è¯•å¾®ä¿¡ç™»å½•
wx.testLogin.testWxLogin();

// æµ‹è¯•ç”¨æˆ·ä¸­å¿ƒç™»å½•
wx.testLogin.testUserCenterLogin();

// æµ‹è¯• Token åˆ·æ–°
wx.testLogin.testTokenRefresh();

// æµ‹è¯•å®Œæ•´æµç¨‹
wx.testLogin.testCompleteLoginFlow();
```

### 3. å…¼å®¹æ€§æµ‹è¯•

```javascript
// æµ‹è¯•æ–°æ—§ç‰ˆæœ¬å…¼å®¹æ€§
wx.testConfig.testCompatibility();
```

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: Mock æ¨¡å¼ä¸‹ç™»å½•å¤±è´¥ï¼Ÿ
```javascript
// æ£€æŸ¥é…ç½®
console.log('å½“å‰é…ç½®:', wx.getCurrentEnvConfig());

// ç¡®ä¿å¯ç”¨äº† Mock å’Œç”¨æˆ·ä¸­å¿ƒ
const config = {
  useMock: true,        // ğŸ‘ˆ å¿…é¡»ä¸º true
  useUserCenter: true   // ğŸ‘ˆ å¿…é¡»ä¸º true
};
```

### Q2: çœŸå®æ¥å£è°ƒç”¨å¤±è´¥ï¼Ÿ
```javascript
// 1. æ£€æŸ¥ç½‘ç»œé…ç½®
// ç¡®ä¿åœ¨ app.json ä¸­é…ç½®äº†åŸŸåç™½åå•

// 2. æ£€æŸ¥æ¥å£åœ°å€
console.log('ç”¨æˆ·ä¸­å¿ƒåœ°å€:', config.userCenterBaseUrl);

// 3. æ£€æŸ¥æ¥å£æ ¼å¼
// ç¡®ä¿åç«¯æ¥å£è¿”å›æ ¼å¼ç¬¦åˆè¦æ±‚
```

### Q3: Token è¿‡æœŸå¤„ç†ï¼Ÿ
```javascript
// ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç† Token åˆ·æ–°
// å¦‚æœåˆ·æ–°å¤±è´¥ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ

// æ‰‹åŠ¨æ£€æŸ¥ Token çŠ¶æ€
import { isTokenExpired, refreshUserCenterToken } from './utils/auth.js';

if (isTokenExpired()) {
  await refreshUserCenterToken();
}
```

### Q4: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Ÿ
```javascript
// åœ¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†çš„ API è°ƒç”¨æ—¥å¿—
// æ‰€æœ‰ API è°ƒç”¨éƒ½ä¼šæœ‰è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

// æŸ¥çœ‹è®¤è¯çŠ¶æ€
import { authManager } from './utils/auth.js';
console.log('å½“å‰è®¤è¯çŠ¶æ€:', authManager);
```

## ğŸ”„ ä»æ—§ç‰ˆæœ¬è¿ç§»

### è‡ªåŠ¨è¿ç§»
- âœ… ç”¨æˆ·é‡æ–°ç™»å½•æ—¶è‡ªåŠ¨ä½¿ç”¨æ–°ç³»ç»Ÿ
- âœ… æ—§çš„è®¤è¯æ•°æ®ä¼šè¢«è‡ªåŠ¨æ¸…ç†
- âœ… æ— éœ€æ‰‹åŠ¨è¿ç§»ç”¨æˆ·æ•°æ®

### æ‰‹åŠ¨è¿ç§»ï¼ˆå¦‚éœ€è¦ï¼‰
```javascript
// æ¸…é™¤æ—§çš„è®¤è¯æ•°æ®
import { clearAuth } from './utils/auth.js';
clearAuth();

// å¼•å¯¼ç”¨æˆ·é‡æ–°ç™»å½•
wx.navigateTo({ url: '/pages/auth/login/login' });
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£**ï¼š`ç”¨æˆ·ä¸­å¿ƒé…ç½®è¯´æ˜.md`
2. **è¿è¡Œæµ‹è¯•**ï¼šä½¿ç”¨æä¾›çš„æµ‹è¯•å‡½æ•°è¯Šæ–­é—®é¢˜
3. **æ£€æŸ¥æ—¥å¿—**ï¼šåœ¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
4. **æ£€æŸ¥é…ç½®**ï¼šç¡®ä¿ç¯å¢ƒé…ç½®æ­£ç¡®

---

**ğŸ‰ æ­å–œï¼ä½ å·²ç»æˆåŠŸé…ç½®äº†ç”¨æˆ·ä¸­å¿ƒè®¤è¯ç³»ç»Ÿï¼**