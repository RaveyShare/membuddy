<!--pages/review/review.wxml-->
<view class="review-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-content">
      <view class="loading-title"></view>
      <view class="loading-text"></view>
      <view class="loading-text"></view>
      <view class="loading-meta"></view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="content-container">
    <!-- å¤´éƒ¨ç»Ÿè®¡ -->
    <view class="stats-header">
      <view class="stats-card">
        <view class="stats-row">
          <view class="stat-item">
            <text class="stat-number">{{todayStats.completed}}</text>
            <text class="stat-label">ä»Šæ—¥å®Œæˆ</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-number">{{todayStats.total}}</text>
            <text class="stat-label">ä»Šæ—¥è®¡åˆ’</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-number">{{todayStats.accuracy}}%</text>
            <text class="stat-label">å‡†ç¡®ç‡</text>
          </view>
        </view>
      </view>
      
      <!-- å¤ä¹ æ¨¡å¼åˆ‡æ¢ -->
      <view class="mode-switcher">
        <view class="mode-tabs">
          <view 
            class="mode-tab {{reviewMode === 'normal' ? 'active' : ''}}"
            data-mode="normal"
            bindtap="switchMode"
          >
            <text class="mode-text">å¸¸è§„å¤ä¹ </text>
          </view>
          <view 
            class="mode-tab {{reviewMode === 'quick' ? 'active' : ''}}"
            data-mode="quick"
            bindtap="switchMode"
          >
            <text class="mode-text">å¿«é€Ÿå¤ä¹ </text>
          </view>
          <view 
            class="mode-tab {{reviewMode === 'intensive' ? 'active' : ''}}"
            data-mode="intensive"
            bindtap="switchMode"
          >
            <text class="mode-text">å¼ºåŒ–å¤ä¹ </text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ— å¤ä¹ å†…å®¹ -->
    <view wx:if="{{totalCount === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ‰</text>
      <text class="empty-title">å¤ªæ£’äº†ï¼</text>
      <text class="empty-desc">æš‚æ—¶æ²¡æœ‰éœ€è¦å¤ä¹ çš„å†…å®¹\nç»§ç»­å­¦ä¹ æ–°çŸ¥è¯†å§</text>
      <button class="go-home-btn" bindtap="goHome">
        <text class="btn-text">è¿”å›é¦–é¡µ</text>
      </button>
    </view>

    <!-- å¤ä¹ å†…å®¹ -->
    <view wx:elif="{{currentItem && !showResults}}" class="review-content">
      <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
      <view class="progress-indicator">
        <view class="progress-bar">
          <view 
            class="progress-fill" 
            style="width: {{(currentIndex / totalCount) * 100}}%"
          ></view>
        </view>
        <view class="progress-text">
          <text class="current">{{currentIndex + 1}}</text>
          <text class="separator">/</text>
          <text class="total">{{totalCount}}</text>
        </view>
      </view>

      <!-- è®°å¿†é¡¹å¡ç‰‡ -->
      <view class="memory-card">
        <view class="card-header">
          <text class="memory-title">{{currentItem.title}}</text>
          <view class="card-actions">
            <view class="action-btn" bindtap="viewMemoryItem">
              <text class="action-icon">ğŸ‘</text>
            </view>
            <view class="action-btn" bindtap="skipCurrent">
              <text class="action-icon">â­</text>
            </view>
          </view>
        </view>
        
        <view class="card-content">
          <text class="memory-content">{{currentItem.content}}</text>
          
          <!-- è®°å¿†è¾…åŠ©é¢„è§ˆ -->
          <view wx:if="{{currentItem.memory_aids}}" class="aids-preview">
            <text class="aids-label">ğŸ’¡ è®°å¿†æç¤º</text>
            <view wx:if="{{currentItem.memory_aids.mind_map}}" class="aid-item">
              <text class="aid-type">æ€ç»´å¯¼å›¾</text>
              <text class="aid-content">{{currentItem.memory_aids.mind_map.central_topic}}</text>
            </view>
            <view wx:if="{{currentItem.memory_aids.key_principles && currentItem.memory_aids.key_principles.length > 0}}" class="aid-item">
              <text class="aid-type">å…³é”®åŸç†</text>
              <text class="aid-content">{{currentItem.memory_aids.key_principles[0].title}}</text>
            </view>
          </view>
        </view>
        
        <view class="card-meta">
          <text class="meta-item">åˆ†ç±»ï¼š{{currentItem.category}}</text>
          <text class="meta-separator">â€¢</text>
          <text class="meta-item">åˆ›å»ºï¼š{{currentItem.created_at}}</text>
        </view>
      </view>

      <!-- ç­”æ¡ˆåŒºåŸŸ -->
      <view wx:if="{{!showAnswer}}" class="answer-section">
        <button class="show-answer-btn" bindtap="showAnswer">
          <text class="btn-text">æ˜¾ç¤ºè®°å¿†è¦ç‚¹</text>
        </button>
        <text class="hint-text">å…ˆå›å¿†ä¸€ä¸‹ï¼Œå†æŸ¥çœ‹è¦ç‚¹</text>
      </view>

      <!-- éš¾åº¦è¯„çº§ -->
      <view wx:else class="difficulty-section">
        <view class="section-header">
          <text class="section-title">å›å¿†æ•ˆæœå¦‚ä½•ï¼Ÿ</text>
          <text class="section-desc">æ ¹æ®ä½ çš„å›å¿†æƒ…å†µé€‰æ‹©éš¾åº¦</text>
        </view>
        
        <view class="difficulty-options">
          <view 
            wx:for="{{difficultyOptions}}" 
            wx:key="value"
            class="difficulty-option"
            style="border-color: {{item.color}}"
            data-difficulty="{{item.value}}"
            bindtap="submitReview"
          >
            <view class="option-header">
              <text class="option-label" style="color: {{item.color}}">{{item.label}}</text>
              <text class="option-desc">{{item.desc}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¤ä¹ ç»“æœ -->
    <view wx:elif="{{showResults}}" class="results-section">
      <view class="results-header">
        <text class="results-icon">ğŸ¯</text>
        <text class="results-title">å¤ä¹ å®Œæˆï¼</text>
        <text class="results-desc">æœ¬è½®å¤ä¹ ç»Ÿè®¡</text>
      </view>
      
      <view class="results-stats">
        <view class="result-card">
          <view class="result-item">
            <text class="result-number">{{completedCount}}</text>
            <text class="result-label">å®Œæˆæ•°é‡</text>
          </view>
          <view class="result-item">
            <text class="result-number">{{todayStats.accuracy}}%</text>
            <text class="result-label">å‡†ç¡®ç‡</text>
          </view>
          <view class="result-item">
            <text class="result-number">{{totalCount}}</text>
            <text class="result-label">æ€»è®¡åˆ’</text>
          </view>
        </view>
      </view>
      
      <view class="results-actions">
        <button class="continue-btn" bindtap="continueReview">
          <text class="btn-text">ç»§ç»­å¤ä¹ </text>
        </button>
        <button class="home-btn" bindtap="goHome">
          <text class="btn-text">è¿”å›é¦–é¡µ</text>
        </button>
      </view>
      
      <view class="results-extra">
        <view class="extra-actions">
          <view class="extra-btn" bindtap="viewHistory">
            <text class="extra-icon">ğŸ“Š</text>
            <text class="extra-text">æŸ¥çœ‹å†å²</text>
          </view>
          <view class="extra-btn" bindtap="shareResults">
            <text class="extra-icon">ğŸ“¤</text>
            <text class="extra-text">åˆ†äº«æˆæœ</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>