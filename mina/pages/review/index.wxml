<!--pages/review/index.wxml-->
<view class="review-page">
  <!-- å¯¼èˆªæ  -->
  <view class="navbar">
    <view class="navbar-content">
      <view class="navbar-left" bindtap="goBack">
        <text class="icon-arrow-left">â€¹</text>
      </view>
      <text class="navbar-title">å¤ä¹ è®°å¿†</text>
      <view class="navbar-right"></view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="main-content">
    <!-- è®°å¿†é¡¹ç›®ä¿¡æ¯ -->
    <view class="memory-item-section">
      <view class="memory-card">
        <view class="card-header">
          <text class="card-title">{{item.title}}</text>
        </view>
        <view class="card-content">
          <textarea 
            class="content-textarea"
            value="{{editableContent}}"
            placeholder="ç¼–è¾‘è®°å¿†å†…å®¹..."
            bindinput="onContentInput"
            auto-height
            maxlength="-1"
          ></textarea>
        </view>
      </view>

      <!-- AIè®°å¿†è¾…åŠ© -->
      <view wx:if="{{item.memory_aids}}" class="memory-aids-card">
        <view class="card-header">
          <view class="header-title">
            <text class="icon-eye">ğŸ‘</text>
            <text class="title-text">AI è®°å¿†è¾…åŠ©</text>
          </view>
        </view>
        <view class="card-content">
          <!-- å…³é”®è¯ -->
          <view wx:if="{{item.memory_aids.keywords && item.memory_aids.keywords.length > 0}}" class="aids-section">
            <text class="section-title">å…³é”®è¯</text>
            <view class="keywords-list">
              <text wx:for="{{item.memory_aids.keywords}}" wx:key="*this" class="keyword-tag">{{item}}</text>
            </view>
          </view>

          <!-- è®°å¿†æŠ€å·§ -->
          <view wx:if="{{item.memory_aids.techniques && item.memory_aids.techniques.length > 0}}" class="aids-section">
            <text class="section-title">è®°å¿†æŠ€å·§</text>
            <view class="techniques-list">
              <text wx:for="{{item.memory_aids.techniques}}" wx:key="*this" class="technique-item">â€¢ {{item}}</text>
            </view>
          </view>

          <!-- è”æƒ³ -->
          <view wx:if="{{item.memory_aids.associations && item.memory_aids.associations.length > 0}}" class="aids-section">
            <text class="section-title">è”æƒ³è®°å¿†</text>
            <view class="associations-list">
              <text wx:for="{{item.memory_aids.associations}}" wx:key="*this" class="association-item">{{item}}</text>
            </view>
          </view>

          <!-- ä¾‹å­ -->
          <view wx:if="{{item.memory_aids.examples && item.memory_aids.examples.length > 0}}" class="aids-section">
            <text class="section-title">ä¾‹å­</text>
            <view class="examples-list">
              <text wx:for="{{item.memory_aids.examples}}" wx:key="*this" class="example-item">{{item}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¤ä¹ çŠ¶æ€æ›´æ–° -->
    <view class="review-status-section">
      <!-- å½“å‰çŠ¶æ€å¡ç‰‡ -->
      <view class="status-card">
        <view class="card-header">
          <view class="header-title">
            <text class="icon-chart">ğŸ“Š</text>
            <text class="title-text">å½“å‰çŠ¶æ€</text>
          </view>
        </view>
        <view class="card-content">
          <view class="status-row">
            <text class="status-label">ä¸‹æ¬¡å¤ä¹ </text>
            <text class="status-value status-primary">{{nextReviewText}}</text>
          </view>
          <view class="status-row">
            <text class="status-label">æŒæ¡åº¦</text>
            <text class="status-value status-success">{{item.mastery}}%</text>
          </view>
          <view class="status-row">
            <text class="status-label">éš¾åº¦</text>
            <view class="difficulty-badge difficulty-{{item.difficulty}}">{{difficultyText}}</view>
          </view>
          <view class="status-row">
            <text class="status-label">åˆ†ç±»</text>
            <view class="category-badge">{{item.category}}</view>
          </view>
          <view wx:if="{{item.tags && item.tags.length > 0}}" class="status-row">
            <text class="status-label">æ ‡ç­¾</text>
            <view class="tags-container">
              <text wx:for="{{item.tags}}" wx:key="*this" class="tag">{{item}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ›´æ–°å¤ä¹ çŠ¶æ€ -->
      <view class="update-card">
        <view class="card-header">
          <view class="header-title">
            <text class="icon-wand">ğŸª„</text>
            <text class="title-text">æ›´æ–°å¤ä¹ çŠ¶æ€</text>
          </view>
        </view>
        <view class="card-content">
          <!-- æŒæ¡åº¦æ»‘å— -->
          <view class="form-group">
            <text class="form-label">æœ¬æ¬¡æŒæ¡åº¦: <text class="mastery-value">{{mastery}}%</text></text>
            <slider 
              class="mastery-slider"
              value="{{mastery}}"
              min="0"
              max="100"
              step="5"
              show-value="{{false}}"
              bindchange="onMasteryChange"
              activeColor="#00d4ff"
              backgroundColor="rgba(255,255,255,0.1)"
            />
          </view>

          <!-- éš¾åº¦è¯„ä¼° -->
          <view class="form-group">
            <text class="form-label">æœ¬æ¬¡éš¾åº¦è¯„ä¼°</text>
            <view class="difficulty-options">
              <view 
                wx:for="{{difficultyOptions}}" 
                wx:key="value"
                class="difficulty-option {{difficulty === item.value ? 'selected' : ''}} difficulty-{{item.value}}"
                data-value="{{item.value}}"
                bindtap="onDifficultyChange"
              >
                <text class="option-text">{{item.label}}</text>
              </view>
            </view>
          </view>

          <!-- ä¸‹æ¬¡å¤ä¹ æ—¶é—´ -->
          <view class="form-group">
            <text class="form-label">ä¸‹æ¬¡å¤ä¹ æ—¶é—´</text>
            <picker 
              class="datetime-picker"
              mode="multiSelector"
              range="{{dateTimeRange}}"
              value="{{dateTimeValue}}"
              bindchange="onDateTimeChange"
            >
              <view class="picker-content">
                <text class="picker-text">{{nextReviewDateText}}</text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>

          <!-- åˆ†ç±»é€‰æ‹© -->
          <view class="form-group">
            <text class="form-label">åˆ†ç±»</text>
            <picker 
              class="category-picker"
              range="{{categoryOptions}}"
              value="{{categoryIndex}}"
              bindchange="onCategoryChange"
            >
              <view class="picker-content">
                <text class="icon-category">ğŸ“</text>
                <text class="picker-text">{{category || 'é€‰æ‹©åˆ†ç±»...'}}</text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>

          <!-- æ ‡ç­¾ç®¡ç† -->
          <view class="form-group">
            <text class="form-label">æ ‡ç­¾</text>
            <view class="tag-input-row">
              <input 
                class="tag-input"
                value="{{currentTag}}"
                placeholder="æ·»åŠ æ–°æ ‡ç­¾..."
                bindinput="onTagInput"
                bindconfirm="addTag"
              />
              <button class="tag-add-btn" bindtap="addTag">æ·»åŠ </button>
            </view>
            <view wx:if="{{tags && tags.length > 0}}" class="tags-list">
              <view wx:for="{{tags}}" wx:key="*this" class="tag-item">
                <text class="tag-text">{{item}}</text>
                <text class="tag-remove" data-tag="{{item}}" bindtap="removeTag">Ã—</text>
              </view>
            </view>
          </view>

          <!-- å®ŒæˆæŒ‰é’® -->
          <button 
            class="complete-btn {{isSubmitting ? 'loading' : ''}}"
            bindtap="completeReview"
            disabled="{{isSubmitting}}"
          >
            <text wx:if="{{isSubmitting}}" class="loading-icon">âŸ³</text>
            <text wx:else class="save-icon">ğŸ’¾</text>
            <text class="btn-text">{{isSubmitting ? 'ä¿å­˜ä¸­...' : 'å®Œæˆå¹¶ä¿å­˜'}}</text>
          </button>
        </view>
      </view>
    </view>
  </view>
</view>