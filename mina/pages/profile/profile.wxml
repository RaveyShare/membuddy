<!--pages/profile/profile.wxml-->
<view class="profile-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-content">
      <view class="loading-avatar"></view>
      <view class="loading-title"></view>
      <view class="loading-text"></view>
      <view class="loading-stats">
        <view class="loading-stat"></view>
        <view class="loading-stat"></view>
        <view class="loading-stat"></view>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="content-container">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="user-card">
      <view class="user-header">
        <view class="avatar-section">
          <image 
            class="user-avatar" 
            src="{{userInfo.avatar_url || '/images/default-avatar.png'}}"
            mode="aspectFill"
          />
        </view>
        
        <view class="user-info">
          <view wx:if="{{!editing}}" class="info-display">
            <text class="user-name">{{userInfo.nickname || 'æœªè®¾ç½®æ˜µç§°'}}</text>
            <text class="user-bio">{{userInfo.bio || 'è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹'}}</text>
            <view class="user-meta">
              <text class="join-date">åŠ å…¥æ—¶é—´ï¼š{{userInfo.created_at}}</text>
            </view>
          </view>
          
          <view wx:else class="info-edit">
            <view class="edit-group">
              <input 
                class="edit-input"
                placeholder="è¯·è¾“å…¥æ˜µç§°"
                value="{{editForm.nickname}}"
                bindinput="onNicknameInput"
                maxlength="20"
              />
            </view>
            <view class="edit-group">
              <textarea 
                class="edit-textarea"
                placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±å§"
                value="{{editForm.bio}}"
                bindinput="onBioInput"
                maxlength="100"
              />
            </view>
          </view>
        </view>
        
        <view class="user-actions">
          <view wx:if="{{!editing}}" class="edit-btn" bindtap="startEdit">
            <text class="edit-icon">âœï¸</text>
          </view>
          <view wx:else class="edit-actions">
            <view class="save-btn" bindtap="saveEdit">
              <text class="save-icon">âœ…</text>
            </view>
            <view class="cancel-btn" bindtap="cancelEdit">
              <text class="cancel-icon">âŒ</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç»Ÿè®¡æ•°æ® -->
      <view class="stats-section">
        <view class="stats-grid">
          <view class="stat-item">
            <text class="stat-number">{{stats.totalMemories}}</text>
            <text class="stat-label">è®°å¿†é¡¹</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-number">{{stats.totalReviews}}</text>
            <text class="stat-label">å¤ä¹ æ¬¡æ•°</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-number">{{stats.streakDays}}</text>
            <text class="stat-label">è¿ç»­å¤©æ•°</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-number">{{stats.accuracy}}%</text>
            <text class="stat-label">å‡†ç¡®ç‡</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠŸèƒ½èœå• -->
    <view class="menu-section">
      <view class="section-title">
        <text class="title-text">åŠŸèƒ½èœå•</text>
      </view>
      
      <view class="menu-list">
        <view 
          wx:for="{{menuItems}}" 
          wx:key="id"
          class="menu-item"
          data-item="{{item}}"
          bindtap="onMenuItemTap"
        >
          <view class="menu-icon">
            <text class="icon-text">{{item.icon}}</text>
          </view>
          <view class="menu-content">
            <text class="menu-title">{{item.title}}</text>
            <text class="menu-desc">{{item.desc}}</text>
          </view>
          <view class="menu-arrow">
            <text class="arrow-icon">â€º</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è®¾ç½®é€‰é¡¹ -->
    <view class="settings-section">
      <view class="section-title">
        <text class="title-text">è®¾ç½®</text>
      </view>
      
      <view class="settings-list">
        <view class="setting-item">
          <view class="setting-info">
            <text class="setting-title">æ¶ˆæ¯é€šçŸ¥</text>
            <text class="setting-desc">æ¥æ”¶é‡è¦æ¶ˆæ¯æé†’</text>
          </view>
          <switch 
            class="setting-switch"
            checked="{{settings.notifications}}"
            data-setting="notifications"
            bindchange="onSettingChange"
          />
        </view>
        
        <view class="setting-item">
          <view class="setting-info">
            <text class="setting-title">è‡ªåŠ¨å¤‡ä»½</text>
            <text class="setting-desc">è‡ªåŠ¨å¤‡ä»½è®°å¿†æ•°æ®</text>
          </view>
          <switch 
            class="setting-switch"
            checked="{{settings.autoBackup}}"
            data-setting="autoBackup"
            bindchange="onSettingChange"
          />
        </view>
        
        <view class="setting-item">
          <view class="setting-info">
            <text class="setting-title">å¤ä¹ æé†’</text>
            <text class="setting-desc">å®šæ—¶æé†’å¤ä¹ è®°å¿†</text>
          </view>
          <switch 
            class="setting-switch"
            checked="{{settings.reviewReminder}}"
            data-setting="reviewReminder"
            bindchange="onSettingChange"
          />
        </view>
        
        <view class="setting-item">
          <view class="setting-info">
            <text class="setting-title">æ·±è‰²æ¨¡å¼</text>
            <text class="setting-desc">ä½¿ç”¨æ·±è‰²ä¸»é¢˜</text>
          </view>
          <switch 
            class="setting-switch"
            checked="{{settings.darkMode}}"
            data-setting="darkMode"
            bindchange="onSettingChange"
          />
        </view>
      </view>
    </view>

    <!-- å…¶ä»–æ“ä½œ -->
    <view class="actions-section">
      <view class="action-list">
        <view class="action-item" bindtap="shareApp">
          <view class="action-icon">
            <text class="icon-text">ğŸ“¤</text>
          </view>
          <view class="action-content">
            <text class="action-title">åˆ†äº«åº”ç”¨</text>
            <text class="action-desc">æ¨èç»™æœ‹å‹ä½¿ç”¨</text>
          </view>
          <view class="action-arrow">
            <text class="arrow-icon">â€º</text>
          </view>
        </view>
      </view>
    </view>

    <!-- é€€å‡ºç™»å½• -->
    <view class="logout-section">
      <button class="logout-btn" bindtap="handleLogout">
        <text class="logout-text">é€€å‡ºç™»å½•</text>
      </button>
    </view>
  </view>
</view>