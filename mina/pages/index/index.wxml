<!--pages/index/index.wxml-->
<view class="index-container">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header-section">
    <view class="header-content">
      <view class="app-title">
        <text class="title-text">MemBuddy</text>
        <text class="subtitle-text">AIè®°å¿†åŠ©æ‰‹</text>
      </view>
      
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view wx:if="{{isAuthenticated}}" class="user-info">
        <view class="user-avatar">
          <image 
            class="avatar-image" 
            src="{{currentUser.avatar_url || '/images/default-avatar.png'}}"
            mode="aspectFill"
          />
        </view>
        <view class="user-details">
          <text class="user-name">{{currentUser.nickname || 'ç”¨æˆ·'}}</text>
          <text class="user-level">Lv.{{currentUser.level || 1}}</text>
        </view>
      </view>
      
      <!-- ä»Šæ—¥ç»Ÿè®¡ -->
      <view class="today-stats">
        <view class="stats-grid">
          <view class="stat-item">
            <text class="stat-number">{{todayStats.reviewed}}</text>
            <text class="stat-label">å·²å¤ä¹ </text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-number">{{todayStats.planned}}</text>
            <text class="stat-label">è®¡åˆ’</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-number">{{todayStats.accuracy}}%</text>
            <text class="stat-label">å‡†ç¡®ç‡</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view class="main-content">
    <!-- è®¤è¯ä¿æŠ¤çš„å†…å®¹åŒºåŸŸ -->
    <auth-guard auto-redirect="{{true}}">
      <!-- å¿«é€Ÿå¤ä¹ å¡ç‰‡ -->
      <view wx:if="{{showQuickReview && quickReview}}" class="quick-review-card">
      <view class="review-header">
        <text class="review-title">âš¡ å¿«é€Ÿå¤ä¹ </text>
        <view class="review-close" bindtap="skipQuickReview">
          <text class="close-icon">âœ•</text>
        </view>
      </view>
      
      <view class="review-content">
        <view class="memory-question">
          <text class="question-text">{{quickReview.memory_item.title}}</text>
        </view>
        
        <view wx:if="{{!quickReview.showAnswer}}" class="review-actions">
          <button class="show-answer-btn" bindtap="showQuickReviewAnswer">
            æ˜¾ç¤ºç­”æ¡ˆ
          </button>
        </view>
        
        <view wx:else class="answer-section">
          <view class="memory-answer">
            <text class="answer-text">{{quickReview.memory_item.content}}</text>
          </view>
          
          <view class="difficulty-rating">
            <text class="rating-label">å›å¿†éš¾åº¦ï¼š</text>
            <view class="rating-buttons">
              <button 
                class="rating-btn easy"
                data-difficulty="1"
                bindtap="submitQuickReview"
              >
                ç®€å•
              </button>
              <button 
                class="rating-btn normal"
                data-difficulty="2"
                bindtap="submitQuickReview"
              >
                ä¸€èˆ¬
              </button>
              <button 
                class="rating-btn hard"
                data-difficulty="3"
                bindtap="submitQuickReview"
              >
                å›°éš¾
              </button>
            </view>
          </view>
        </view>
      </view>
      </view>

      <!-- è®°å¿†è¾“å…¥åŒºåŸŸ -->
      <view class="input-section">
      <view class="input-card">
        <view class="input-header">
          <text class="input-title">ğŸ’¡ è®°ä½æ–°å†…å®¹</text>
        </view>
        
        <view class="input-content">
          <textarea 
            class="memory-input"
            placeholder="{{inputPlaceholder}}"
            value="{{inputContent}}"
            bindinput="onInputChange"
            maxlength="1000"
            auto-height
          />
          
          <view class="input-actions">
            <button 
              class="action-btn save-btn"
              bindtap="saveMemoryItem"
              disabled="{{!inputContent.trim()}}"
            >
              ğŸ’¾ ä¿å­˜
            </button>
            <button 
              class="action-btn generate-btn"
              bindtap="generateMemoryAids"
              disabled="{{!inputContent.trim() || generating}}"
            >
              <text wx:if="{{generating}}">ğŸ”„ ç”Ÿæˆä¸­...</text>
              <text wx:else>ğŸ¤– AIè¾…åŠ©</text>
            </button>
          </view>
        </view>
      </view>
      </view>

      <!-- è®°å¿†è¾…åŠ©é¢„è§ˆ -->
      <view wx:if="{{generatedAids}}" class="aids-preview">
      <view class="preview-header">
        <text class="preview-title">ğŸ¯ è®°å¿†è¾…åŠ©å·²ç”Ÿæˆ</text>
        <view class="preview-close" bindtap="closeAidsPreview">
          <text class="close-icon">âœ•</text>
        </view>
      </view>
      
      <view class="aids-grid">
        <view 
          wx:for="{{aidTypes}}" 
          wx:key="key"
          wx:if="{{generatedAids[item.key]}}"
          class="aid-item"
          data-type="{{item.key}}"
          bindtap="viewAidDetail"
        >
          <view class="aid-icon">
            <text class="icon-text">{{item.icon}}</text>
          </view>
          <text class="aid-label">{{item.label}}</text>
        </view>
      </view>
      
      <view class="preview-tip">
        <text class="tip-text">ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†å†…å®¹</text>
      </view>
      </view>

    <!-- åŠŸèƒ½å¡ç‰‡ -->
    <view class="features-section">
      <view class="section-header">
        <text class="section-title">ğŸš€ å¿«é€ŸåŠŸèƒ½</text>
      </view>
      
      <view class="features-grid">
        <view 
          wx:for="{{featureCards}}" 
          wx:key="id"
          class="feature-card"
          style="border-left-color: {{item.color}}"
          data-card="{{item}}"
          bindtap="onFeatureCardTap"
        >
          <view class="feature-icon">
            <text class="icon-text">{{item.icon}}</text>
          </view>
          <view class="feature-info">
            <text class="feature-title">{{item.title}}</text>
            <text class="feature-desc">{{item.desc}}</text>
          </view>
          <view class="feature-arrow">
            <text class="arrow-icon">â€º</text>
          </view>
        </view>
      </view>
    </view>

      <!-- æœ€è¿‘è®°å¿†é¡¹ -->
      <view class="recent-section">
        <view class="section-header">
          <text class="section-title">ğŸ“š æœ€è¿‘è®°å¿†</text>
          <view class="section-action" bindtap="goToMemoryLibrary">
            <text class="action-text">æŸ¥çœ‹å…¨éƒ¨</text>
            <text class="action-arrow">â€º</text>
          </view>
        </view>
      
      <view wx:if="{{loadingRecent}}" class="loading-recent">
        <view wx:for="{{[1,2,3]}}" wx:key="*this" class="loading-memory-item">
          <view class="loading-title"></view>
          <view class="loading-content"></view>
          <view class="loading-meta"></view>
        </view>
      </view>
      
      <view wx:elif="{{recentMemories.length > 0}}" class="recent-list">
        <view 
          wx:for="{{recentMemories}}" 
          wx:key="id"
          class="recent-item"
          data-memory="{{item}}"
          bindtap="onRecentMemoryTap"
        >
          <view class="memory-content">
            <text class="memory-title">{{item.title}}</text>
            <text class="memory-preview">{{item.content}}</text>
          </view>
          <view class="memory-meta">
            <text class="memory-category">{{item.category}}</text>
            <text class="memory-time">{{item.updated_at}}</text>
          </view>
        </view>
      </view>
      
      <view wx:else class="empty-recent">
        <view class="empty-icon">
          <text class="icon-text">ğŸ“</text>
        </view>
        <text class="empty-text">è¿˜æ²¡æœ‰è®°å¿†å†…å®¹</text>
        <text class="empty-desc">å¼€å§‹è®°å½•ä½ æƒ³è®°ä½çš„å†…å®¹å§</text>
      </view>
      </view>
    </auth-guard>
  </view>
</view>