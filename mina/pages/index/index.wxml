<!--pages/index/index.wxml-->
<view class="index-container-modern animate-fade-in">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration animate-float"></view>

  <!-- ç°ä»£å¯¼èˆªæ  -->
  <view class="modern-navbar animate-fade-in-down">
    <view class="navbar-content">
      <text class="navbar-title animate-fade-in-left">å°æä»è®°å¿†æ­å­</text>
      <view class="navbar-actions animate-fade-in-right">
        <button class="settings-btn glass-btn hover-lift" bindtap="onSettingsTap">
          <text class="btn-icon">âš™ï¸</text>
        </button>
      </view>
    </view>
  </view>

  <!-- Hero åŒºåŸŸï¼ˆä¿ç•™ç°ä»£é£æ ¼ç‰ˆæœ¬ï¼Œç§»é™¤é‡å¤æ—§ç‰ˆï¼‰ -->
  <view class="hero-section animate-fade-in-up">
    <view class="hero-content glass-card hover-lift">
      <text class="hero-title animate-fade-in-up animate-delay-1">AI è®°å¿†åŠ©æ‰‹</text>
      <text class="hero-subtitle animate-fade-in-up animate-delay-2">è®©å­¦ä¹ æ›´é«˜æ•ˆï¼Œè®°å¿†æ›´æŒä¹…</text>

      <view class="search-box animate-fade-in-up animate-delay-3">
        <input class="search-input glass-input" placeholder="æœç´¢è®°å¿†å†…å®¹..." />
        <button class="search-btn gradient-btn hover-scale">
          <text class="btn-icon">ğŸ”</text>
        </button>
      </view>

      <view class="hero-actions animate-fade-in-up animate-delay-4">
        <button class="primary-btn gradient-btn hover-scale" bindtap="onQuickReview">
          <text class="btn-icon">âš¡</text>
          <text class="btn-text">å¿«é€Ÿå¤ä¹ </text>
        </button>
        <button class="secondary-btn glass-btn hover-scale" bindtap="onMemoryInput">
          <text class="btn-icon">ğŸ“</text>
          <text class="btn-text">è®°å¿†è¾“å…¥</text>
        </button>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹ï¼ˆå•ä¸€ main-content + å•ä¸€ auth-guardï¼‰ -->
  <view class="main-content">
    <auth-guard auto-redirect="{{true}}">
      <!-- ç”¨æˆ·ä¿¡æ¯å’Œç»Ÿè®¡ -->
      <view class="user-stats-card glass-card">
        <view class="user-info-section">
          <view class="user-avatar-large">
            <image 
              class="avatar-image-large" 
              src="{{currentUser.avatar_url || '/images/default-avatar.png'}}"
              mode="aspectFill"
            />
          </view>
          <view class="user-details-large">
            <text class="user-name-large">{{currentUser.nickname || 'ç”¨æˆ·'}}</text>
            <view class="user-meta">
              <text class="user-level-badge">Lv.{{currentUser.level || 1}}</text>
              <text class="user-status status-online">åœ¨çº¿</text>
            </view>
          </view>
        </view>

        <view class="stats-grid-modern">
          <view class="stat-item-modern">
            <text class="stat-number-modern">{{todayStats.reviewed}}</text>
            <text class="stat-label-modern">å·²å¤ä¹ </text>
          </view>
          <view class="stat-divider-modern"></view>
          <view class="stat-item-modern">
            <text class="stat-number-modern">{{todayStats.planned}}</text>
            <text class="stat-label-modern">è®¡åˆ’</text>
          </view>
          <view class="stat-divider-modern"></view>
          <view class="stat-item-modern">
            <text class="stat-number-modern">{{todayStats.accuracy}}%</text>
            <text class="stat-label-modern">å‡†ç¡®ç‡</text>
          </view>
        </view>
      </view>

      <!-- å¿«é€Ÿå¤ä¹ å¡ç‰‡ -->
      <view wx:if="{{showQuickReview && quickReview}}" class="quick-review-card glass-card">
        <view class="review-header-modern">
          <text class="review-title-modern">âš¡ å¿«é€Ÿå¤ä¹ </text>
          <view class="review-close-modern" bindtap="skipQuickReview">
            <text class="close-icon-modern">âœ•</text>
          </view>
        </view>

        <view class="review-content-modern">
          <view class="memory-question-modern">
            <text class="question-text-modern">{{quickReview.memory_item.title}}</text>
          </view>

          <view wx:if="{{!quickReview.showAnswer}}" class="review-actions-modern">
            <button class="show-answer-btn-modern gradient-btn" bindtap="showQuickReviewAnswer">
              æ˜¾ç¤ºç­”æ¡ˆ
            </button>
          </view>

          <view wx:else class="answer-section-modern">
            <view class="memory-answer-modern">
              <text class="answer-text-modern">{{quickReview.memory_item.content}}</text>
            </view>

            <view class="difficulty-rating-modern">
              <text class="rating-label-modern">å›å¿†éš¾åº¦ï¼š</text>
              <view class="rating-buttons-modern">
                <button 
                  class="rating-btn-modern rating-easy"
                  data-difficulty="1"
                  bindtap="submitQuickReview"
                >
                  ç®€å•
                </button>
                <button 
                  class="rating-btn-modern rating-normal"
                  data-difficulty="2"
                  bindtap="submitQuickReview"
                >
                  ä¸€èˆ¬
                </button>
                <button 
                  class="rating-btn-modern rating-hard"
                  data-difficulty="3"
                  bindtap="submitQuickReview"
                >
                  å›°éš¾
                </button>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- è®°å¿†è¾“å…¥åŒºåŸŸ -->
      <view class="input-section-modern">
        <view class="input-card-modern glass-card">
          <view class="input-header-modern">
            <text class="input-title-modern">ğŸ’¡ è®°ä½æ–°å†…å®¹</text>
          </view>

          <view class="input-content-modern">
            <textarea 
              class="memory-input-modern glass-input"
              placeholder="è¾“å…¥ä½ æƒ³è®°ä½çš„å†…å®¹..."
              value="{{inputContent}}"
              bindinput="onInputChange"
              maxlength="1000"
              auto-height
            />

            <view class="input-actions-modern">
              <button 
                class="action-btn-modern save-btn-modern gradient-btn"
                bindtap="saveMemoryItem"
                disabled="{{!inputContent.trim()}}"
              >
                ğŸ’¾ ä¿å­˜
              </button>
              <button 
                class="action-btn-modern generate-btn-modern glass-btn"
                bindtap="generateMemoryAids"
                disabled="{{!inputContent.trim() || generating}}"
              >
                <text wx:if="{{generating}}">ğŸ”„ ç”Ÿæˆä¸­...</text>
                <text wx:else>ğŸ¤– AIè¾…åŠ©</text>
              </button>
            </view>
          </view>
        </view>
      </view>

      <!-- è®°å¿†è¾…åŠ©é¢„è§ˆ -->
      <view wx:if="{{generatedAids}}" class="aids-preview-modern glass-card">
        <view class="preview-header-modern">
          <text class="preview-title-modern">ğŸ¯ è®°å¿†è¾…åŠ©å·²ç”Ÿæˆ</text>
          <view class="preview-close-modern" bindtap="closeAidsPreview">
            <text class="close-icon-modern">âœ•</text>
          </view>
        </view>

        <view class="aids-grid-modern">
          <view 
            wx:for="{{aidTypes}}" 
            wx:key="key"
            wx:if="{{generatedAids[item.key]}}"
            class="aid-item-modern"
            data-type="{{item.key}}"
            bindtap="viewAidDetail"
          >
            <view class="aid-icon-modern">
              <text class="icon-text-modern">{{item.icon}}</text>
            </view>
            <text class="aid-label-modern">{{item.label}}</text>
          </view>
        </view>

        <view class="preview-tip-modern">
          <text class="tip-text-modern">ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†å†…å®¹</text>
        </view>
      </view>

      <!-- åŠŸèƒ½å¡ç‰‡ -->
      <view class="features-section-modern">
        <view class="section-header-modern">
          <text class="section-title-modern">ğŸš€ å¿«é€ŸåŠŸèƒ½</text>
        </view>

        <view class="features-grid-modern">
          <view 
            wx:for="{{featureCards}}" 
            wx:key="id"
            class="feature-card-modern glass-card"
            data-card="{{item}}"
            bindtap="onFeatureCardTap"
          >
            <view class="feature-icon-modern">
              <text class="icon-text-modern">{{item.icon}}</text>
            </view>
            <view class="feature-info-modern">
              <text class="feature-title-modern">{{item.title}}</text>
              <text class="feature-desc-modern">{{item.desc}}</text>
            </view>
            <view class="feature-arrow-modern">
              <text class="arrow-icon-modern">â€º</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æœ€è¿‘è®°å¿†é¡¹ -->
      <view class="recent-section">
        <view class="section-header">
          <text class="section-title">ğŸ“š æœ€è¿‘è®°å¿†</text>
          <view class="section-action" bindtap="goToMemoryLibrary">
            <text class="action-text">æŸ¥çœ‹å…¨éƒ¨</text>
            <text class="action-arrow">â€º</text>
          </view>
        </view>

        <view wx:if="{{loadingRecent}}" class="loading-recent">
          <view wx:for="{{[1,2,3]}}" wx:key="*this" class="loading-memory-item">
            <view class="loading-title"></view>
            <view class="loading-content"></view>
            <view class="loading-meta"></view>
          </view>
        </view>

        <view wx:elif="{{recentMemories.length > 0}}" class="recent-list">
          <view 
            wx:for="{{recentMemories}}" 
            wx:key="id"
            class="recent-item"
            data-memory="{{item}}"
            bindtap="onRecentMemoryTap"
          >
            <view class="memory-content">
              <text class="memory-title">{{item.title}}</text>
              <text class="memory-preview">{{item.content}}</text>
            </view>
            <view class="memory-meta">
              <text class="memory-category">{{item.category}}</text>
              <text class="memory-time">{{item.updated_at}}</text>
            </view>
          </view>
        </view>

        <view wx:else class="empty-recent">
          <view class="empty-icon">
            <text class="icon-text">ğŸ“</text>
          </view>
          <text class="empty-text">è¿˜æ²¡æœ‰è®°å¿†å†…å®¹</text>
          <text class="empty-desc">å¼€å§‹è®°å½•ä½ æƒ³è®°ä½çš„å†…å®¹å§</text>
        </view>
      </view>
    </auth-guard>
  </view>
</view>