<!--pages/index/index-modern.wxml-->
<!-- ç°ä»£æ·±è‰²ä¸»é¢˜é¦–é¡µå¸ƒå±€ -->
<view class="dark-theme">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-header">
    <view class="brand-section">
      <view class="brand-logo">ğŸŒ°</view>
      <text class="brand-text">å°æä»è®°å¿†æ­å­</text>
    </view>
    
    <view class="nav-actions" wx:if="{{!isAuthenticated}}">
      <text class="nav-action" bindtap="onLoginTap">ç™»å½•</text>
      <text class="nav-action" bindtap="onRegisterTap">æ³¨å†Œ</text>
    </view>
    
    <view class="nav-actions" wx:else>
      <text class="nav-action" bindtap="onProfileTap">{{currentUser.nickname}}</text>
    </view>
  </view>

  <!-- HeroåŒºåŸŸ -->
  <view class="hero-section animate-fadeInUp">
    <text class="hero-title">æ¬¢è¿ä½¿ç”¨å°æä»è®°å¿†æ­å­</text>
    <text class="hero-subtitle">è¾“å…¥å†…å®¹ï¼ŒAIç”Ÿæˆè®°å¿†å·¥å…·ã€æ™ºèƒ½æé†’å¤ä¹ </text>
    
    <!-- ä¸»è¦è¾“å…¥åŒºåŸŸ -->
    <view class="hero-input-container">
      <input 
        class="hero-input"
        placeholder="è®°ä¸€ä¸‹..."
        value="{{inputContent}}"
        bindinput="onInputChange"
        confirm-type="send"
        bindconfirm="onQuickSubmit"
      />
      <view class="mic-button" bindtap="onVoiceInput">
        <text class="mic-icon">ğŸ¤</text>
      </view>
      <view class="primary-action-btn" bindtap="onQuickSubmit">
        <text class="primary-action-icon">â–¶</text>
      </view>
    </view>
  </view>

  <!-- è®¤è¯ä¿æŠ¤çš„å†…å®¹åŒºåŸŸ -->
  <auth-guard auto-redirect="{{true}}">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view wx:if="{{isAuthenticated}}" class="user-info-card animate-fadeInUp">
      <view class="user-header">
        <image 
          class="user-avatar-large"
          src="{{currentUser.avatar_url || '/images/default-avatar.png'}}"
          mode="aspectFill"
        />
        <view class="user-meta">
          <text class="user-name">{{currentUser.nickname || 'ç”¨æˆ·'}}</text>
          <text class="user-level-badge">Lv.{{currentUser.level || 1}}</text>
        </view>
        <view class="stats-card">
          <view class="stat-row">
            <text class="stat-number">{{todayStats.reviewed}}</text>
            <text class="stat-label">å·²å¤ä¹ </text>
          </view>
          <view class="divider"></view>
          <view class="stat-row">
            <text class="stat-number">{{todayStats.accuracy}}%</text>
            <text class="stat-label">å‡†ç¡®ç‡</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«é€Ÿå¤ä¹ å¡ç‰‡ -->
    <view wx:if="{{showQuickReview && quickReview}}" class="quick-review-card animate-fadeInUp">
      <view class="card-header">
        <text class="card-title">âš¡ å¿«é€Ÿå¤ä¹ </text>
        <view class="card-close" bindtap="skipQuickReview">
          <text>âœ•</text>
        </view>
      </view>
      
      <view class="review-content">
        <view class="review-question">
          <text>{{quickReview.memory_item.title}}</text>
        </view>
        
        <view wx:if="{{!quickReview.showAnswer}}" class="text-center">
          <button class="btn btn-primary" bindtap="showQuickReviewAnswer">
            æ˜¾ç¤ºç­”æ¡ˆ
          </button>
        </view>
        
        <view wx:else class="answer-section">
          <view class="review-answer">
            <text class="answer-text">{{quickReview.memory_item.content}}</text>
          </view>
          
          <view class="text-center">
            <text class="rating-label">å›å¿†éš¾åº¦ï¼š</text>
            <view class="difficulty-buttons">
              <button 
                class="difficulty-btn easy"
                data-difficulty="1"
                bindtap="submitQuickReview"
              >
                ç®€å•
              </button>
              <button 
                class="difficulty-btn normal"
                data-difficulty="2"
                bindtap="submitQuickReview"
              >
                ä¸€èˆ¬
              </button>
              <button 
                class="difficulty-btn hard"
                data-difficulty="3"
                bindtap="submitQuickReview"
              >
                å›°éš¾
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è®°å¿†è¾“å…¥åŒºåŸŸ -->
    <view class="content-card animate-fadeInUp">
      <view class="card-header">
        <text class="card-title">ğŸ’¡ è®°ä½æ–°å†…å®¹</text>
      </view>
      
      <view class="input-area">
        <textarea 
          class="memory-textarea"
          placeholder="è¾“å…¥ä½ æƒ³è®°ä½çš„å†…å®¹..."
          value="{{inputContent}}"
          bindinput="onInputChange"
          maxlength="1000"
          auto-height
        />
      </view>
      
      <view class="action-buttons">
        <button 
          class="btn btn-secondary"
          bindtap="saveMemoryItem"
          disabled="{{!inputContent.trim()}}"
        >
          ğŸ’¾ ä¿å­˜
        </button>
        <button 
          class="btn btn-primary"
          bindtap="generateMemoryAids"
          disabled="{{!inputContent.trim() || generating}}"
        >
          <text wx:if="{{generating}}">ğŸ”„ ç”Ÿæˆä¸­...</text>
          <text wx:else>ğŸ¤– AIè¾…åŠ©</text>
        </button>
      </view>
    </view>

    <!-- è®°å¿†è¾…åŠ©é¢„è§ˆ -->
    <view wx:if="{{generatedAids}}" class="aids-preview animate-fadeInUp">
      <view class="card-header">
        <text class="card-title">ğŸ¯ è®°å¿†è¾…åŠ©å·²ç”Ÿæˆ</text>
        <view class="card-close" bindtap="closeAidsPreview">
          <text>âœ•</text>
        </view>
      </view>
      
      <view class="aids-grid">
        <view 
          wx:for="{{aidTypes}}" 
          wx:key="key"
          wx:if="{{generatedAids[item.key]}}"
          class="aid-item"
          data-type="{{item.key}}"
          bindtap="viewAidDetail"
        >
          <view class="aid-icon">{{item.icon}}</view>
          <text class="aid-label">{{item.label}}</text>
        </view>
      </view>
      
      <view class="text-center">
        <text class="text-gradient" style="font-size: 24rpx;">ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†å†…å®¹</text>
      </view>
    </view>

    <!-- å¿«é€ŸåŠŸèƒ½åŒºåŸŸ -->
    <view class="content-card animate-fadeInUp">
      <view class="card-header">
        <text class="card-title">ğŸš€ å¿«é€ŸåŠŸèƒ½</text>
      </view>
      
      <view class="features-grid">
        <view 
          wx:for="{{featureCards}}" 
          wx:key="id"
          class="feature-card"
          data-card="{{item}}"
          bindtap="onFeatureCardTap"
        >
          <view class="feature-icon">{{item.icon}}</view>
          <view class="feature-content">
            <text class="feature-title">{{item.title}}</text>
            <text class="feature-desc">{{item.desc}}</text>
          </view>
          <text class="feature-arrow">â€º</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨é—´è· -->
    <view style="height: 120rpx;"></view>
  </auth-guard>

  <!-- åº•éƒ¨æ ‡ç­¾æ  -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 'home' ? 'active' : ''}}" bindtap="onTabChange" data-tab="home">
      <text class="tab-icon">ğŸ </text>
      <text class="tab-label">é¦–é¡µ</text>
    </view>
    <view class="tab-item {{currentTab === 'memory' ? 'active' : ''}}" bindtap="onTabChange" data-tab="memory">
      <text class="tab-icon">ğŸ“š</text>
      <text class="tab-label">è®°å¿†åº“</text>
    </view>
    <view class="tab-item {{currentTab === 'review' ? 'active' : ''}}" bindtap="onTabChange" data-tab="review">
      <text class="tab-icon">ğŸ”„</text>
      <text class="tab-label">å¤ä¹ </text>
    </view>
    <view class="tab-item {{currentTab === 'profile' ? 'active' : ''}}" bindtap="onTabChange" data-tab="profile">
      <text class="tab-icon">ğŸ‘¤</text>
      <text class="tab-label">æˆ‘çš„</text>
    </view>
  </view>
</view>