<!--pages/memory-library/memory-library.wxml-->
<view class="memory-library-container">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header">
    <view class="header-content">
      <view class="title-section">
        <text class="page-title">è®°å¿†åº“</text>
        <text class="memory-count">{{memories.length}} æ¡è®°å¿†</text>
      </view>
      
      <view class="header-actions">
        <view class="action-btn" bindtap="onToggleSearch">
          <text class="icon">ğŸ”</text>
        </view>
        <view class="action-btn" bindtap="onSortChange">
          <text class="icon">ğŸ“Š</text>
        </view>
      </view>
    </view>
    
    <!-- æœç´¢æ¡† -->
    <view class="search-section" wx:if="{{showSearch}}">
      <view class="search-box">
        <input 
          class="search-input"
          placeholder="æœç´¢è®°å¿†å†…å®¹..."
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearch"
        />
        <view class="search-actions">
          <view class="search-btn" bindtap="onSearch" wx:if="{{searchKeyword}}">
            <text class="icon">ğŸ”</text>
          </view>
          <view class="clear-btn" bindtap="onClearSearch" wx:if="{{searchKeyword}}">
            <text class="icon">âœ•</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰ -->
  <view class="categories-section">
    <scroll-view class="categories-scroll" scroll-x="true">
      <view class="categories-list">
        <view 
          class="category-item {{selectedCategory === item.id ? 'active' : ''}}"
          wx:for="{{categories}}"
          wx:key="id"
          data-category="{{item.id}}"
          bindtap="onCategoryChange"
        >
          <text class="category-name">{{item.name}}</text>
          <text class="category-count" wx:if="{{item.count > 0}}">({{item.count}})</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- è®°å¿†é¡¹åˆ—è¡¨ -->
  <view class="memories-section">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-section" wx:if="{{loading && memories.length === 0}}">
      <view class="loading-item" wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="loading-avatar"></view>
        <view class="loading-content">
          <view class="loading-title"></view>
          <view class="loading-desc"></view>
          <view class="loading-meta"></view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-section" wx:if="{{!loading && memories.length === 0}}">
      <view class="empty-icon">ğŸ“š</view>
      <text class="empty-title">æš‚æ— è®°å¿†å†…å®¹</text>
      <text class="empty-desc">{{searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³è®°å¿†' : 'å¼€å§‹åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªè®°å¿†å§'}}</text>
      <button class="btn btn-primary" bindtap="onCreateMemory" wx:if="{{!searchKeyword}}">
        åˆ›å»ºè®°å¿†
      </button>
    </view>
    
    <!-- è®°å¿†é¡¹åˆ—è¡¨ -->
    <view class="memories-list" wx:if="{{memories.length > 0}}">
      <view 
        class="memory-item"
        wx:for="{{memories}}"
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="onViewMemory"
      >
        <view class="memory-content">
          <view class="memory-header">
            <text class="memory-title">{{item.title}}</text>
            <view class="memory-actions" catchtap="">
              <view class="action-btn" data-id="{{item.id}}" bindtap="onEditMemory">
                <text class="icon">âœï¸</text>
              </view>
              <view class="action-btn" data-id="{{item.id}}" bindtap="onShareMemory">
                <text class="icon">ğŸ“¤</text>
              </view>
              <view class="action-btn danger" data-id="{{item.id}}" bindtap="onDeleteMemory">
                <text class="icon">ğŸ—‘ï¸</text>
              </view>
            </view>
          </view>
          
          <view class="memory-body">
            <text class="memory-content-text">{{item.content}}</text>
          </view>
          
          <view class="memory-footer">
            <view class="memory-meta">
              <text class="meta-item">{{item.category || 'æœªåˆ†ç±»'}}</text>
              <text class="meta-separator">â€¢</text>
              <text class="meta-item">{{item.created_at_formatted}}</text>
              <text class="meta-separator" wx:if="{{item.memory_aids_count > 0}}">â€¢</text>
              <text class="meta-item" wx:if="{{item.memory_aids_count > 0}}">{{item.memory_aids_count}}ä¸ªè¾…åŠ©å·¥å…·</text>
            </view>
            
            <view class="memory-tags" wx:if="{{item.tags && item.tags.length > 0}}">
              <text 
                class="tag"
                wx:for="{{item.tags}}"
                wx:for-item="tag"
                wx:key="*this"
              >
                #{{tag}}
              </text>
            </view>
          </view>
        </view>
        
        <!-- è®°å¿†è¾…åŠ©é¢„è§ˆ -->
        <view class="memory-aids-preview" wx:if="{{item.memory_aids_count > 0}}">
          <view class="aids-indicator">
            <text class="aids-text">åŒ…å« {{item.memory_aids_count}} ä¸ªè®°å¿†è¾…åŠ©å·¥å…·</text>
            <text class="aids-arrow">â†’</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more-section" wx:if="{{memories.length > 0}}">
      <view class="load-more" wx:if="{{loading}}">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      <view class="no-more" wx:if="{{!hasMore && !loading}}">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šå†…å®¹äº†</text>
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨åˆ›å»ºæŒ‰é’® -->
  <view class="fab" bindtap="onCreateMemory">
    <text class="fab-icon">+</text>
  </view>
</view>