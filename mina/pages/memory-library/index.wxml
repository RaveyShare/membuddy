<view class="memory-library-page">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="navbar">
    <view class="navbar-content">
      <view class="navbar-left" bindtap="goBack">
        <text class="icon-arrow-left">â€¹</text>
      </view>
      <view class="navbar-title">è®°å¿†åº“</view>
      <view class="navbar-right"></view>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-container">
    <view class="stats-grid">
      <view class="stat-card">
        <view class="stat-icon">ğŸ“š</view>
        <view class="stat-content">
          <text class="stat-label">è®°å¿†é¡¹ç›®</text>
          <text class="stat-value">{{stats.totalItems}}</text>
        </view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ¯</view>
        <view class="stat-content">
          <text class="stat-label">å¹³å‡æŒæ¡åº¦</text>
          <text class="stat-value">{{stats.averageMastery}}%</text>
        </view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">â°</view>
        <view class="stat-content">
          <text class="stat-label">æ€»å¤ä¹ æ¬¡æ•°</text>
          <text class="stat-value">{{stats.totalReviews}}</text>
        </view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">â­</view>
        <view class="stat-content">
          <text class="stat-label">æ”¶è—é¡¹ç›®</text>
          <text class="stat-value">{{stats.starredItems}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="search-filter-container">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢è®°å¿†é¡¹ç›®..." 
        value="{{searchQuery}}" 
        bindinput="onSearchInput"
      />
    </view>
    <view class="filter-row">
      <picker 
        class="filter-picker" 
        mode="selector" 
        range="{{categoryOptions}}" 
        range-key="label" 
        value="{{categoryIndex}}" 
        bindchange="onCategoryChange"
      >
        <view class="picker-content">
          <text class="filter-icon">ğŸ“‚</text>
          <text class="filter-text">{{categoryOptions[categoryIndex].label}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
      <picker 
        class="filter-picker" 
        mode="selector" 
        range="{{sortOptions}}" 
        range-key="label" 
        value="{{sortIndex}}" 
        bindchange="onSortChange"
      >
        <view class="picker-content">
          <text class="filter-icon">ğŸ“Š</text>
          <text class="filter-text">{{sortOptions[sortIndex].label}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- è®°å¿†é¡¹ç›®åˆ—è¡¨ -->
  <view class="memory-items-container">
    <view wx:if="{{isLoading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <view wx:elif="{{sortedItems.length === 0}}" class="empty-container">
      <text class="empty-icon">ğŸ§ </text>
      <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å¿†é¡¹ç›®</text>
    </view>
    
    <view wx:else class="memory-items-grid">
      <view 
        wx:for="{{sortedItems}}" 
        wx:key="id" 
        class="memory-item-card" 
        bindtap="onItemTap" 
        data-item="{{item}}"
      >
        <!-- å¡ç‰‡å¤´éƒ¨ -->
        <view class="card-header">
          <view class="card-title-row">
            <text class="card-title">{{item.title}}</text>
            <view wx:if="{{item.starred}}" class="star-icon">â­</view>
          </view>
          <view class="card-badges">
            <text class="difficulty-badge difficulty-{{item.difficulty}}">{{item.difficulty}}</text>
            <text class="category-badge">{{item.category}}</text>
          </view>
          <view class="card-actions" catchtap="onCardActions" data-item="{{item}}">
            <text class="more-icon">â‹¯</text>
          </view>
        </view>
        
        <!-- å¡ç‰‡å†…å®¹ -->
        <view class="card-content">
          <text class="card-description">{{item.content}}</text>
          
          <!-- æ ‡ç­¾ -->
          <view wx:if="{{item.tags && item.tags.length > 0}}" class="tags-container">
            <text 
              wx:for="{{item.tags}}" 
              wx:for-item="tag" 
              wx:key="*this" 
              class="tag"
            >
              {{tag}}
            </text>
          </view>
          
          <!-- æŒæ¡åº¦ -->
          <view class="mastery-container">
            <view class="mastery-row">
              <text class="mastery-label">æŒæ¡åº¦</text>
              <text class="mastery-value mastery-{{item.masteryLevel}}">{{item.mastery}}%</text>
            </view>
            <view class="mastery-bar">
              <view class="mastery-progress" style="width: {{item.mastery}}%"></view>
            </view>
          </view>
          
          <!-- å¤ä¹ ä¿¡æ¯ -->
          <view class="review-info">
            <view class="review-date">
              <text class="review-icon">ğŸ“…</text>
              <text class="review-text">{{item.nextReviewText}}</text>
            </view>
            <view class="review-time">
              <text class="time-icon">â°</text>
              <text class="time-text">{{item.relativeTimeText}}</text>
            </view>
          </view>
          
          <!-- æ“ä½œæŒ‰é’® -->
          <view class="card-buttons">
            <button 
              class="btn btn-primary" 
              bindtap="onStartReview" 
              data-item="{{item}}"
            >
              å¼€å§‹å¤ä¹ 
            </button>
            <button 
              class="btn btn-secondary" 
              bindtap="onViewDetails" 
              data-item="{{item}}"
            >
              æŸ¥çœ‹è¯¦æƒ…
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œèœå• -->
  <view wx:if="{{showActionMenu}}" class="action-menu-overlay" bindtap="hideActionMenu">
    <view class="action-menu" catchtap="">
      <view class="action-item" bindtap="onViewDetails" data-item="{{selectedItem}}">
        <text class="action-icon">ğŸ‘ï¸</text>
        <text class="action-text">æŸ¥çœ‹è¯¦æƒ…</text>
      </view>
      <view class="action-item" bindtap="onEditItem" data-item="{{selectedItem}}">
        <text class="action-icon">âœï¸</text>
        <text class="action-text">ç¼–è¾‘</text>
      </view>
      <view class="action-item action-delete" bindtap="onDeleteItem" data-item="{{selectedItem}}">
        <text class="action-icon">ğŸ—‘ï¸</text>
        <text class="action-text">åˆ é™¤</text>
      </view>
    </view>
  </view>
</view>